<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #f4f7f6; --card: #fff; --text: #333; }
        [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; }
        
        body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        .card { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { margin-bottom: 20px; text-align: center; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; margin-bottom: 30px; }
        .stat-box { background: var(--card); padding: 15px; border-radius: 10px; font-weight: bold; }
        .num { font-size: 2rem; display: block; }
        .label { font-size: 0.9rem; opacity: 0.7; }
        
        .green { color: #10b981; }
        .red { color: #ef4444; }
        
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        .back-btn { display: block; margin-bottom: 20px; text-decoration: none; color: var(--text); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">&larr; Home</a>
    <h1>Performance Analytics</h1>

    <div class="stats-grid">
        <div class="stat-box">
            <span class="num" id="total">0</span>
            <span class="label">Total Attempted</span>
        </div>
        <div class="stat-box">
            <span class="num green" id="correct">0</span>
            <span class="label">Correct</span>
        </div>
        <div class="stat-box">
            <span class="num red" id="wrong">0</span>
            <span class="label">Incorrect</span>
        </div>
    </div>

    <div class="card">
        <canvas id="myChart"></canvas>
    </div>

    <div class="card" style="text-align: center;">
        <h3>Need Improvement?</h3>
        <p>You have <span id="wrong-count" class="red">0</span> questions marked as incorrect.</p>
        <a href="revision.html" style="display:inline-block; background:#0056b3; color:white; padding:10px 20px; border-radius:8px; text-decoration:none; margin-top:10px;">Start Active Recall Session</a>
    </div>
</div>

<script>
    const data = JSON.parse(localStorage.getItem("medtrix_analytics") || "[]");
    
    const total = data.length;
    const correct = data.filter(i => i.isCorrect).length;
    const wrong = total - correct;

    document.getElementById('total').innerText = total;
    document.getElementById('correct').innerText = correct;
    document.getElementById('wrong').innerText = wrong;
    document.getElementById('wrong-count').innerText = wrong;

    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Correct', 'Incorrect'],
            datasets: [{
                data: [correct, wrong],
                backgroundColor: ['#10b981', '#ef4444'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%'
        }
    });

    // Theme support
    if(localStorage.getItem('medtrix-theme') === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
    }
</script>

</body>
</html>